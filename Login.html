<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in - Varnikaa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
      /* Reset and Base Styles */
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          position: relative;
          transition: all 0.3s ease;
      }

      /* Dark Mode Styles */
      body.dark-mode {
          background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
          color: #ecf0f1;
      }

      /* Dark Mode Toggle */
      #darkModeToggle {
          position: fixed !important;
          top: 20px;
          right: 30px;
          font-size: 24px;
          cursor: pointer;
          color: #fff;
          z-index: 1000;
          transition: all 0.3s ease;
          padding: 10px;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.2);
          backdrop-filter: blur(10px);
      }

      #darkModeToggle:hover {
          transform: scale(1.1);
          background: rgba(255, 255, 255, 0.3);
      }

      /* Header Section */
      .varnikaa {
          text-align: center;
          margin-bottom: 40px;
          animation: fadeInDown 1s ease-out;
      }

      .varnikaa p:first-child {
          font-size: 4rem !important;
          color: #8B4513 !important;
          font-family: 'Georgia', 'Times New Roman', serif !important;
          font-weight: bold;
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
          margin-bottom: 10px;
          background: linear-gradient(45deg, #8B4513, #D2691E);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
      }

      .varnikaa p:last-child {
          font-weight: 600 !important;
          font-size: 1.2rem !important;
          color: #fff;
          text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
          line-height: 1.4;
          max-width: 600px;
          margin: 0 auto;
      }

      /* Form Container */
      .auth-container {
          background: rgba(255, 255, 255, 0.95);
          padding: 40px;
          border-radius: 20px;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.2);
          animation: fadeInUp 1s ease-out 0.3s both;
          max-width: 500px;
          width: 95%;
      }

      body.dark-mode .auth-container {
          background: rgba(44, 62, 80, 0.95);
          color: #ecf0f1;
          border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Form Title */
      .form-title {
          text-align: center;
          font-size: 2rem;
          margin-bottom: 30px;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
      }

      /* Input Styles */
      #email,
      #password{
          width: 100%;
          height: 50px;
          padding: 15px 20px;
          border: 2px solid #e0e0e0;
          border-radius: 25px;
          font-size: 16px;
          transition: all 0.3s ease;
          background: #f8f9fa;
          margin-bottom: 20px;
          outline: none;
      }

      #email:focus,
      #password:focus {
          border-color: #667eea;
          box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
          transform: translateY(-2px);
          background: #fff;
      }

      body.dark-mode #email,
      body.dark-mode #password {
          background: #34495e;
          border-color: #5a6c7d;
          color: #ecf0f1;
      }

      body.dark-mode #email:focus,
      body.dark-mode #password:focus {
          border-color: #3498db;
          background: #2c3e50;
      }

      /* Button Styles */
      .auth-btn {
          width: 100%;
          height: 50px;
          border: none;
          border-radius: 25px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          text-transform: uppercase;
          letter-spacing: 1px;
          margin-bottom: 15px;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
          position: relative;
          overflow: hidden;
      }

      .auth-btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
      }

      .auth-btn:active {
          transform: translateY(0);
      }

      .auth-btn:disabled {
          opacity: 0.7;
          cursor: not-allowed;
          transform: none;
      }

      /* Create Account Button */
      .create-account-btn {
          background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%) !important;
          color: white !important;
          box-shadow: 0 4px 15px rgba(86, 171, 47, 0.4);
      }

      .create-account-btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(86, 171, 47, 0.6);
      }

      /* Toggle Mode */
      .toggle-mode {
          text-align: center;
          margin: 20px 0;
          color: #667eea;
          cursor: pointer;
          font-weight: 500;
      }

      .toggle-mode span {
          color: #764ba2;
          font-weight: 600;
          text-decoration: underline;
      }

      .toggle-mode:hover span {
          color: #5a67d8;
      }

      /* Forgot Password Link */
      .forgot-password {
          color: #667eea !important;
          text-align: center !important;
          margin: 20px 0 !important;
          cursor: pointer;
          transition: all 0.3s ease;
          font-weight: 500;
          text-decoration: none;
          display: block;
      }

      .forgot-password:hover {
          color: #5a67d8 !important;
          text-decoration: underline;
      }

      /* Password Message Styles */
      .message {
          margin: 10px 0 20px 0;
          padding: 10px 15px;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          transition: all 0.3s ease;
      }

      .message.invalid {
          background-color: rgba(231, 76, 60, 0.1);
          color: #e74c3c;
          border: 1px solid rgba(231, 76, 60, 0.3);
      }

      .message.valid {
          background-color: rgba(39, 174, 96, 0.1);
          color: #27ae60;
          border: 1px solid rgba(39, 174, 96, 0.3);
      }

      /* Bottom Text */
      .bottom-text {
          position: fixed !important;
          bottom: 20px !important;
          left: 50% !important;
          transform: translateX(-50%) !important;
          color: rgba(255, 255, 255, 0.8) !important;
          font-size: 14px !important;
          text-align: center;
          max-width: 90%;
      }

      body.dark-mode .bottom-text {
          color: rgba(236, 240, 241, 0.8) !important;
      }

      /* Animations */
      @keyframes fadeInDown {
          from {
              opacity: 0;
              transform: translateY(-30px);
          }
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }

      @keyframes fadeInUp {
          from {
              opacity: 0;
              transform: translateY(30px);
          }
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }

      /* Loading Animation */
      .loading {
          position: relative;
          pointer-events: none;
      }

      .loading::after {
          content: '';
          position: absolute;
          width: 20px;
          height: 20px;
          top: 50%;
          left: 50%;
          margin-left: -10px;
          margin-top: -10px;
          border: 2px solid transparent;
          border-top: 2px solid #fff;
          border-radius: 50%;
          animation: spin 1s linear infinite;
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
          .varnikaa p:first-child {
              font-size: 2.5rem !important;
          }
          
          .varnikaa p:last-child {
              font-size: 1rem !important;
              padding: 0 20px;
          }
          
          .auth-container {
              margin: 20px;
              padding: 30px 25px;
          }
          
          #email,
          #password {
              height: 45px !important;
          }
          
          .auth-btn {
              height: 45px !important;
          }
      }

      @media (max-width: 480px) {
          .varnikaa p:first-child {
              font-size: 2rem !important;
          }
          
          .auth-container {
              padding: 25px 20px;
          }
          
          #darkModeToggle {
              top: 15px;
              right: 20px;
              font-size: 20px;
          }
      }

      /* Hover Effects */
      .auth-container:hover {
          transform: translateY(-2px);
          box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
      }

      /* Focus Styles for Accessibility */
      button:focus,
      input:focus {
          outline: 2px solid #667eea;
          outline-offset: 2px;
      }

      /* Notification Styles */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .notification.show {
        transform: translateX(0);
      }

      .notification.success {
        background: linear-gradient(135deg, #10b981, #059669);
      }

      .notification.error {
        background: linear-gradient(135deg, #ef4444, #dc2626);
      }
      /* Password Wrapper Styles (New) */
      .password-wrapper {
          position: relative;
          margin-bottom: 20px; /* Moves the margin from the input to the wrapper */
      }

      /* Re-apply input styles to the input element inside the wrapper, but remove the bottom margin */
      .password-wrapper #email,
      .password-wrapper #password {
          margin-bottom: 0; /* Remove margin from the input itself */
      }

      /* Eye Icon Styles (New) */
      #togglePassword {
          position: absolute;
          top: 50%;
          right: 20px;
          transform: translateY(-50%);
          cursor: pointer;
          color: #6c757d; /* Neutral color */
          font-size: 1.1rem;
          transition: color 0.2s ease;
          z-index: 5;
      }

      #togglePassword:hover {
          color: #495057;
      }

      /* Dark Mode adjustment for the icon */
      body.dark-mode #togglePassword {
          color: #b0b8bf;
      }
    </style>
</head>
<body>
    <i id="darkModeToggle" class="fas fa-moon"></i>
    
    <div class="varnikaa">
        <p>Varnikaa</p>
        <p>Varnikaa – Weaving Traditions into Every Thread,<br>Celebrating You in Every Shade.</p>
    </div>
    
    <div class="auth-container">
        <h2 class="form-title" id="formTitle">Welcome Back</h2>
        
        <form id="authForm">
            <input type="email" id="email" name="email" placeholder="Enter Your Email" required>
            <div class="password-wrapper">
                <input type="password" id="password" name="password" placeholder="Enter Your Password" required>
                <i id="togglePassword" class="fas fa-eye-slash"></i>
            </div>
            <div id="passwordMessage" class="message"></div>
            
            <button type="submit" class="auth-btn" id="authBtn">
                <span id="btnText">Sign In</span>
            </button>
            
            <a href="#" class="forgot-password" id="forgotPassword">Forgotten Password?</a>
            
            <div class="toggle-mode" id="toggleMode">
                Don't have an account? <span>Sign up</span>
            </div>
        </form>
    </div>
    
    <p class="bottom-text">Create a Page for a celebrity, brand or business.</p>

    <script>
        // --- UI & General Logic ---

        let isLogin = true;
        const formTitle = document.getElementById('formTitle');
        const authBtn = document.getElementById('authBtn');
        const btnText = document.getElementById('btnText');
        const toggleMode = document.getElementById('toggleMode');
        const passwordMessage = document.getElementById('passwordMessage');
        const forgotPassword = document.getElementById('forgotPassword');
        const passwordInput = document.getElementById('password');
        const togglePassword = document.getElementById('togglePassword');
        const authForm = document.getElementById('authForm');


        // Function to toggle password visibility
        togglePassword.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            togglePassword.classList.toggle('fa-eye');
            togglePassword.classList.toggle('fa-eye-slash');
        });

        // Dark mode toggle
        const toggleIcon = document.getElementById("darkModeToggle");
        toggleIcon.addEventListener("click", () => {
            document.body.classList.toggle("dark-mode");
            if (document.body.classList.contains("dark-mode")) {
                toggleIcon.classList.remove("fa-moon");
                toggleIcon.classList.add("fa-sun");
            } else {
                toggleIcon.classList.remove("fa-sun");
                toggleIcon.classList.add("fa-moon");
            }
        });

        // Toggle between login/signup forms
        toggleMode.addEventListener("click", () => {
            isLogin = !isLogin;
            authBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                formTitle.textContent = isLogin ? "Welcome Back" : "Join Varnikaa";
                btnText.textContent = isLogin ? "Sign In" : "Create Account";
                // Ensure the button style changes for the 'Create Account' button
                authBtn.className = isLogin ? "auth-btn" : "auth-btn create-account-btn"; 
                toggleMode.innerHTML = isLogin 
                    ? 'Don\'t have an account? <span>Sign up</span>' 
                    : 'Already have an account? <span>Sign in</span>';
                passwordMessage.textContent = '';
                passwordMessage.className = 'message';
                authBtn.style.transform = 'scale(1)';
            }, 150);
        });

        // Password validation function (FIXED REGEX)
        function validatePassword() {
            const password = document.getElementById("password").value;
            const message = document.getElementById("passwordMessage");
            if (!isLogin) {
                // FIXED REGEX: Allows creation of account with strong password.
                const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%?#&^_-])[A-Za-z\d@$!%?#&^_-]{8,}$/;
                if (!regex.test(password)) {
                    message.textContent = "Password needs 8+ chars, with uppercase, lowercase, number, and special character.";
                    message.className = "message invalid";
                    return false;
                } else {
                    message.textContent = "Strong password!";
                    message.className = "message valid";
                    return true;
                }
            }
            return true;
        }

        // Real-time password validation for signup
        document.getElementById("password").addEventListener("input", () => {
            if (!isLogin) {
                validatePassword();
            }
        });

        // Show notification function
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // --- Supabase Backend Logic (FIXED) ---

        // Supabase configuration
        const SUPABASE_URL = 'https://dgpeydvdqxoazejoydco.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRncGV5ZHZkcXhvYXplam95ZGNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NDc0NTMsImV4cCI6MjA3NTIyMzQ1M30.0VoMb9qFjuHg15DabWYQ0RtKOHv1esB9cr66aU8_nbU';

        const { createClient } = supabase;
        const _supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Form submission handler
        authForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value.trim();
            
            if (!email || !password) {
                showNotification("Please fill in all fields.", 'error');
                return;
            }

            if (!isLogin && !validatePassword()) {
                return;
            }

            authBtn.classList.add('loading');
            btnText.textContent = isLogin ? "Signing in..." : "Creating account...";
            authBtn.disabled = true;

            let response;
            try {
                if (isLogin) {
                    response = await _supabase.auth.signInWithPassword({ email, password });
                } else {
                    response = await _supabase.auth.signUp({ email, password });
                }

                if (response.error) {
                    throw response.error;
                }

                if (!isLogin && response.data.user && !response.data.session) {
                    // Successful signup, but REQUIRES EMAIL CONFIRMATION
                    showNotification("Success! Please check your email to confirm your account.", 'success');
                    btnText.textContent = "Check Email";
                } else {
                    // Successful login or instant sign-in
                    showNotification("Welcome back!", 'success');
                    btnText.textContent = "Success!";
                    setTimeout(() => {
                        window.location.href = "varnikaa.html";
                    }, 1000);
                }

            } catch (error) {
                let message = error.message || "An unexpected error occurred.";
                
                if (error.status === 400 && message.includes("already registered")) {
                    message = "This email is already registered.";
                } else if (error.status === 400 && message.includes("Invalid login credentials")) {
                    message = "Incorrect email or password.";
                }
                
                showNotification(message, 'error');
                console.error("Auth error:", error);
            } finally {
                // Restore button state
                authBtn.classList.remove('loading');
                authBtn.disabled = false;
                if (btnText.textContent === "Signing in..." || btnText.textContent === "Creating account...") {
                    btnText.textContent = isLogin ? "Sign In" : "Create Account";
                }
            }
        });

        // Auto redirect if already logged in (on page load)
        _supabase.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                console.log("User already logged in, redirecting...");
                window.location.href = "varnikaa.html";
            }
        });

        // Forgot password handler
        forgotPassword.addEventListener("click", async (e) => {
            e.preventDefault();
            
            const email = document.getElementById("email").value.trim();
            
            if (!email) {
                showNotification("Please enter your email address first.", 'error');
                return;
            }

            try {
                const { error } = await _supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.href,
                });

                if (error) throw error;
                showNotification("Password reset link sent! Check your inbox.", 'success');
            } catch (error) {
                showNotification(error.message || "Error sending reset email.", 'error');
            }
        });

    </script>
</body>
</html>