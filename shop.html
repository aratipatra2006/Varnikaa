<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop All Products - VARNIKAA</title>
    <link rel="stylesheet" href="shop.css">
    <link href="https://fonts.googleapis.com/css2?family=Jacques+Francois&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Jomolhari&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Federant&display=swap" rel="stylesheet">
</head>
<body>
    <div class="headerHead">
        <div class="abril-fatface-regular" style="display: inline-block; font-size: 30px; font-weight: bold; text-align: center; margin-left: 30px; color: rgb(27, 55, 70);">VARNIKAA</div>
        <div class="search">
            <form id="searchForm">
                <input type="text" id="searchInput" name="search" placeholder="Try or Search Saree, kurta, necklace, ring and kids wear">
                <i class="fas fa-search"></i>
            </form>
        </div>
        <div class="seperator"></div>
        <a href="cart.html">
            <i class="fas fa-shopping-cart" style="font-size: xx-large;"></i>
        </a>
    </div>
    <div class="nav">
        <a href="varnikaa.html">Home</a>
        <a href="About.html">About</a>
        <a href="shop.html">Shop</a>
        <a target="_blank" href="contact.html">Contact</a>
        <select name="language" style="margin-left: 150px; padding: 5px;background-color: lightcyan;">
            <option value="english">English</option>
            <option value="hindi">हिंदी</option><br /><br />
        </select>
        <i id="darkModeToggle" class="fas fa-moon" style="font-size: 22px; cursor: pointer;"></i>
    </div>
    
    <div class="section-title">Shop</div>
    
    <div class="shop-container">
        
        <aside class="filter-sidebar">
            <h3>Refine Products</h3>
            
            <div class="filter-group">
                <h4>Category</h4>
                <select id="categoryFilter" onchange="applyFilters()">
                    <option value="all">All Categories</option>
                    </select>
            </div>

            <div class="filter-group">
                <h4>Max Price</h4>
                <input type="range" id="priceRange" min="500" max="85000" value="85000" step="100" oninput="updatePriceLabel(); applyFilters()">
                <span id="priceValue">Max: ₹85,000</span>
            </div>

            <div class="filter-group rating-checkbox-group">
                <h4>Customer Rating</h4>
                <label><input type="checkbox" name="rating" value="4.5" onchange="applyFilters()"> 4.5 Stars & Up</label>
                <label><input type="checkbox" name="rating" value="4.0" onchange="applyFilters()"> 4.0 Stars & Up</label>
                <label><input type="checkbox" name="rating" value="3.5" onchange="applyFilters()"> 3.5 Stars & Up</label>
            </div>
            
            <button class="add-button reset-button" onclick="resetFilters()">
                <i class="fas fa-redo"></i> Reset Filters
            </button>
        </aside>

        <main class="product-content">
            <div class="sort-bar">
                <label for="sortOrder">Sort By:</label>
                <select id="sortOrder" onchange="applyFilters()">
                    <option value="default">Featured</option>
                    <option value="price-asc">Price: Low to High</option>
                    <option value="price-desc">Price: High to Low</option>
                    <option value="name-asc">Name: A to Z</option>
                </select>
            </div>

            <div id="productGrid" class="product-list">
                </div>
            
             <p id="noProductsMessage" style="text-align: center; margin-top: 50px; font-style: italic; color: var(--text-light); display: none;">No products match your current filters.</p>
        </main>
    </div>
    
    <div id="productModal" class="product-modal" aria-hidden="true">
        <div class="product-modal__backdrop" id="modalBackdrop"></div>
        <div class="product-modal__panel" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <button id="modalClose" class="modal-close" aria-label="Close product details">&times;</button>
            <div class="modal-grid">
                <div class="modal-left">
                    <img id="modalMainImg" src="" alt="Product image" />
                    <div id="modalThumbs" class="modal-thumbs"></div>
                </div>
                <div class="modal-right">
                    <h2 id="modalTitle"></h2>
                    <div id="modalPrice" class="modal-price"></div>
                    <p id="modalDesc" class="modal-desc"></p>
                    <div class="modal-actions">
                        <button id="modalAddCart" class="btn">Add to cart</button>
                        <button id="modalBuyNow" class="btn secondary">Buy now</button>
                    </div>
                    <hr>
                    <section id="modalReviews">
                        <h3>Reviews</h3>
                        <div id="reviewsList"></div>
                        <div id="noReviews" class="empty" style="display:none">No reviews yet. Be the first!</div>
                        <div class="review-form">
                            <input id="reviewerNameModal" type="text" placeholder="Your name" />
                            <select id="reviewRatingModal">
                                <option value="">Rating</option>
                                <option value="5">5 — Excellent</option>
                                <option value="4">4 — Good</option>
                                <option value="3">3 — Okay</option>
                                <option value="2">2 — Poor</option>
                                <option value="1">1 — Bad</option>
                            </select>
                            <textarea id="reviewTextModal" placeholder="Write your review..."></textarea>
                            <div style="display:flex;gap:8px;margin-top:8px">
                                <button id="submitReviewModal" class="btn">Submit review</button>
                                <button id="clearReviewModal" class="btn secondary">Clear</button>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div>
            <p>Varnikaa</p>
            <p style="padding-left: 20px"> © 2025 Varnikaa. All rights reserved</p>
        </div>
        <div style="position: relative; top: 60px">
            <p style="font-size: 25px">About Us</p><br />
            <a href="#Our Story">Our Story</a><br /><br />
            <a href="#Blog">Blog</a><br /><br />
            <div class="social-icons">
                <a href="https://www.instagram.com/shopvarnikaa/" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" target="_blank" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                <a href="https://x.com/ShopVarnikaa" target="_blank" aria-label="Twitter"><i class="fab fa-x-twitter"></i></a>
                <a href="https://www.youtube.com/@shopvarnikaa" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
            </div>
        </div>
        <div style="position: relative; top: 60px">
            <p style="font-size: 25px; padding-bottom: 20px">Quick Links</p>
            <a href="#Shipping and Exchanges">Shipping and Exchanges</a>
            <a href="#Privacy Policy"></a><br /><br />
            <a href="#Terms and Conditions">Terms and Conditions</a><br /><br />
            <a href="#FAQs">FAQs</a><br /><br />
            <a href="#Track Orders">Track Orders</a>
        </div>
        <div style="position: relative; top: 40px; font-size: 20px">
            <i class="fas fa-map-marker-alt"></i> Find a Shop Near You<br /><br />
            <i class="fas fa-envelope"></i> shopvarnikaa@gmail.com<br /><br />
            <i class="fas fa-phone"></i> +91 8915643689
        </div>
    </div>

    <style>
        /* Replicating key variables from your existing CSS for context */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --warm-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --text-dark: #2d3748;
            --text-light: #718096;
            --white: #ffffff;
            --light-text-dark-mode: #e2e8f0;
            --dark-bg-dark-mode: #1a202c;
            --shadow-medium: 0 10px 25px rgba(0, 0, 0, 0.15);
            --border-radius-lg: 20px;
        }

        /* 1. MAIN SHOP LAYOUT */
        .shop-container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 30px 60px;
            gap: 30px;
            align-items: flex-start;
        }

        /* 2. FILTER SIDEBAR STYLES */
        .filter-sidebar {
            width: 280px;
            flex-shrink: 0;
            background: linear-gradient(145deg, var(--white), #f8f9ff);
            border-radius: var(--border-radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-medium);
            position: sticky;
            top: 150px; 
            height: fit-content;
            text-align: left;
        }
        .filter-group {
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
        }
        .filter-group:last-child { border-bottom: none; padding-bottom: 0; }
        .filter-group h4 {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }
        .filter-sidebar select, 
        .filter-sidebar input[type="range"],
        .sort-bar select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #cbd5e0;
            background-color: var(--white);
            color: var(--text-dark);
            font-size: 1em;
            cursor: pointer;
        }
        #priceValue { display: block; margin-top: 10px; font-weight: 600; color: #764ba2; text-align: center; }
        .rating-checkbox-group label { display: block; margin-bottom: 8px; cursor: pointer; font-size: 0.95em; color: var(--text-light); }
        
        .reset-button { background: #e53e3e; color: white; padding: 10px; border-radius: 10px; border: none; width: 100%; cursor: pointer; margin-top: 10px;}

        /* 3. SORTING BAR STYLES */
        .product-content { flex-grow: 1; }
        .sort-bar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid #e2e8f0;
        }
        .sort-bar label { font-weight: 500; color: var(--text-dark); margin-right: 10px; }
        .sort-bar select { width: 200px; }

        /* 4. PRODUCT GRID ADJUSTMENTS */
        #productGrid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
             gap: 30px;
             padding: 0; 
             margin: 0;
        }
        
        .product-rating { color: #f59e0b; margin-top: 5px; }

        /* 5. DARK MODE OVERRIDES */
        body.dark-mode .filter-sidebar { background-color: #2d3748; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6); }
        body.dark-mode .filter-group h4,
        body.dark-mode .sort-bar label { color: var(--light-text-dark-mode); }
        body.dark-mode .filter-sidebar select, 
        body.dark-mode .filter-sidebar input[type="range"],
        body.dark-mode .sort-bar select { background-color: #1a202c; border-color: #4a5568; color: var(--light-text-dark-mode); }
        body.dark-mode .filter-group { border-bottom-color: #4a5568; }

        /* 6. RESPONSIVE ADJUSTMENTS */
        @media (max-width: 900px) {
            .shop-container { flex-direction: column; padding: 20px 15px 40px; }
            .filter-sidebar { width: 100%; position: static; margin-bottom: 20px; }
        }
    </style>

    <script>
        
        // --- 1. PRODUCT DATA (Extracted from your HTML) ---
        const initialProducts = [
            { id: "saree-001", title: "Dark Green Silk Minakari Banarasi Saree", category: "Sarees", price: 2629, rating: 4.5, image: "assets/saree2.webp", desc: "Exquisite Banarasi silk saree with detailed minakari work." },
            { id: "saree-002", title: "Karagiri Multicolor Banarasi Silk Saree with Blouse Piece", category: "Sarees", price: 6079, rating: 4.8, image: "assets/saree5.webp", desc: "Multicolor silk saree, perfect for weddings and festive occasions." },
            { id: "saree-003", title: "Alkananda In True Purple Handloom Banarasi Silk Saree", category: "Sarees", price: 23850, rating: 4.7, image: "assets/saree18.webp", desc: "A luxurious purple handloom saree with heavy zari work." },
            { id: "saree-004", title: "Elegant Pink Banarasi Silk Saree with Paisley Design, Zari Weaving, and Tassels", category: "Sarees", price: 1549, rating: 3.9, image: "assets/saree20.jpg", desc: "Affordable and elegant pink saree, ideal for daily wear or small events." },
            { id: "kurta-001", title: "RangDeep Floral Printed Regular Pure Cotton", category: "Kurtas", price: 1610, rating: 4.1, image: "assets/kurta1.webp", desc: "Comfortable and stylish pure cotton floral printed kurta." },
            { id: "kurta-002", title: "Women Floral Embroidered Regular Kurta with Trouser", category: "Kurtas", price: 1689, rating: 4.2, image: "assets/kurta10.jpg", desc: "Embroidered kurta set including matching trousers." },
            { id: "kurta-003", title: "Off-White Printed Cotton Straight Kurta With Palazzos & Dupatta", category: "Kurtas", price: 1499, rating: 4.0, image: "assets/kurta12.jpg", desc: "Complete cotton set for a classic, elegant look." },
            { id: "kurta-004", title: "Rajasthani Angrakha Cotton Kurta Set with Palazzo For Women", category: "Kurtas", price: 1849, rating: 4.6, image: "assets/kurta20.webp", desc: "Traditional Angrakha style kurta with palazzo pants." },
            { id: "ring-001", title: "Ben Platinum Band for Woman", category: "Rings", price: 42196, rating: 5.0, image: "assets/ring2.webp", desc: "Simple yet elegant platinum band ring." },
            { id: "ring-002", title: "Precious Platinum Ring", category: "Rings", price: 78464, rating: 4.9, image: "assets/ring10.jpg", desc: "A high-end platinum ring with diamond accents." },
            { id: "ring-003", title: "Platinum couple ring", category: "Rings", price: 25425, rating: 4.4, image: "assets/ring13.jpg", desc: "A stylish platinum ring, often bought as a set." },
            { id: "ring-004", title: "9 Pointer Platinum Diamond Ring", category: "Rings", price: 81400, rating: 5.0, image: "assets/ring18.jpg", desc: "A dazzling 9-pointer diamond ring set in platinum." },
            { id: "necklace-001", title: "Antique Lakshmi Pendant Necklace Chain", category: "Necklaces", price: 1099, rating: 3.8, image: "assets/neck20.webp", desc: "Traditional antique gold-plated necklace with a Lakshmi pendant." },
            { id: "necklace-002", title: "Orna Zircom American Diamond Silver Necklace Set", category: "Necklaces", price: 1351, rating: 4.2, image: "assets/neck19.webp", desc: "A budget-friendly American diamond necklace set." },
            { id: "necklace-003", title: "Orna Zircom American Diamond Rose Gold Necklace Set", category: "Necklaces", price: 1399, rating: 4.0, image: "assets/neck18.jpg", desc: "Rose gold finish American diamond necklace for a modern look." },
            { id: "necklace-004", title: "Gopika, Premium Gold Jewellery Finish Bridal Long Diamond Necklace Set for Women", category: "Necklaces", price: 5497, rating: 4.9, image: "assets/neck9.webp", desc: "A gorgeous bridal necklace set, heavy and detailed." },
            { id: "kids-001", title: "Party wear Birthday Frock", category: "Kids Wear", price: 3329, rating: 4.6, image: "assets/kid1.webp", desc: "Beautiful party frock perfect for birthdays." },
            { id: "kids-002", title: "Multi Color Designer Gown for Girls", category: "Kids Wear", price: 4450, rating: 4.5, image: "assets/kid9.webp", desc: "A stunning designer gown for young girls." },
            { id: "kids-003", title: "Traditional Embroidered Girls Palazzo Set", category: "Kids Wear", price: 3290, rating: 4.1, image: "assets/kid11.webp", desc: "Comfortable and stylish embroidered palazzo set." },
            { id: "kids-004", title: "Rama Sequin Midi for Girls", category: "Kids Wear", price: 2130, rating: 3.5, image: "assets/kid17.webp", desc: "A fun midi dress with sequin detailing." }
        ];

        // --- 2. DOM Elements (Shop) ---
        const productGrid = document.getElementById('productGrid');
        const categoryFilter = document.getElementById('categoryFilter');
        const priceRange = document.getElementById('priceRange');
        const priceValue = document.getElementById('priceValue');
        const sortOrder = document.getElementById('sortOrder');
        const noProductsMessage = document.getElementById('noProductsMessage');
        const allRatingCheckboxes = document.querySelectorAll('input[name="rating"]');
        const darkModeToggle = document.getElementById("darkModeToggle");


        // --- 3. HELPER FUNCTIONS ---

        function getStarRatingHTML(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 !== 0;
            let starsHTML = '';
            for (let i = 0; i < 5; i++) {
                if (i < fullStars) {
                    starsHTML += '<i class="fas fa-star"></i>';
                } else if (i === fullStars && halfStar) {
                    starsHTML += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    starsHTML += '<i class="far fa-star" style="color:#ccc;"></i>'; 
                }
            }
            return `<span style="font-size:1.2em; margin-right:5px;">${starsHTML}</span> (${rating})`;
        }

        function populateCategoryFilter() {
            const categories = [...new Set(initialProducts.map(p => p.category))];
            categories.sort().forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }
        
        function updatePriceLabel() {
            priceValue.textContent = `Max: ₹${parseInt(priceRange.value).toLocaleString('en-IN')}`;
        }

        // --- 4. CORE DYNAMIC LOGIC ---

        function renderProducts(products) {
            productGrid.innerHTML = '';
            
            if (products.length === 0) {
                noProductsMessage.style.display = 'block';
                return;
            }
            noProductsMessage.style.display = 'none';

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product'; 
                
                card.dataset.id = product.id; 
                card.dataset.desc = product.desc;
                
                card.innerHTML = `
                    <img src="${product.image}" alt="${product.title}" onerror="this.onerror=null;this.src='placeholder.jpg';">
                    <p class="product-title">${product.title}</p>
                    <p class="product-price">₹ ${product.price.toLocaleString('en-IN')}</p>
                    <div class="product-rating">${getStarRatingHTML(product.rating)}</div>
                    <button class="add-button" onclick="addToCart(event, '${product.id}', '${product.title}', ${product.price})">ADD TO CART</button>
                `;
                
                // Attach click listener for modal opening 
                card.addEventListener('click', (ev) => {
                    if (ev.target.closest('.add-button')) return; 
                    openProductModal(card.dataset.id, card);
                });

                productGrid.appendChild(card);
            });
        }

        function applyFilters() {
            let filteredProducts = [...initialProducts];
            
            // 1. Category Filter
            const selectedCategory = categoryFilter.value;
            if (selectedCategory !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.category === selectedCategory);
            }
            
            // 2. Price Range Filter
            const maxPrice = parseInt(priceRange.value);
            filteredProducts = filteredProducts.filter(p => p.price <= maxPrice);
            
            // 3. Rating Filter
            const selectedRatings = Array.from(allRatingCheckboxes)
                .filter(cb => cb.checked)
                .map(cb => parseFloat(cb.value));

            if (selectedRatings.length > 0) {
                const minSelectedRating = Math.min(...selectedRatings);
                filteredProducts = filteredProducts.filter(p => p.rating >= minSelectedRating);
            }

            // 4. Sorting Logic
            const sortMethod = sortOrder.value;
            switch (sortMethod) {
                case 'price-asc':
                    filteredProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-desc':
                    filteredProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'name-asc':
                    filteredProducts.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                default:
                    break;
            }
            
            renderProducts(filteredProducts);
        }

        function resetFilters() {
            document.getElementById('categoryFilter').value = 'all'; 
            document.getElementById('priceRange').value = 85000; 
            document.getElementById('sortOrder').value = 'default'; 
            updatePriceLabel(); 
            document.querySelectorAll('input[name=rating]').forEach(cb => cb.checked = false); 
            applyFilters();
        }
        
        // --- 5. ADAPTED MODAL/CART LOGIC ---

        function addToCart(event, id, title, price) {
            event.stopPropagation(); 
            
            const button = event.target.closest('.add-button');
            const productData = { id, title, price: `₹ ${price.toLocaleString('en-IN')}`, img: initialProducts.find(p => p.id === id)?.image || 'placeholder.jpg' };
            
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            cart.push(productData); 
            localStorage.setItem('cart', JSON.stringify(cart));
            
            button.classList.add('success');
            setTimeout(()=> button.classList.remove('success'), 700);
            showTempNotif('Item added to cart!', 'success');
        }
        
        // Dark Mode Logic (Retained)
        darkModeToggle.addEventListener("click", () => {
            document.body.classList.toggle("dark-mode");
            if (document.body.classList.contains("dark-mode")) {
                darkModeToggle.classList.remove("fa-moon");
                darkModeToggle.classList.add("fa-sun");
            } else {
                darkModeToggle.classList.remove("fa-sun");
                darkModeToggle.classList.add("fa-moon");
            }
        });


        // --- MODAL AND REVIEWS LOGIC (Retained for functionality) ---
        const escapeHtml = (s = '') => (s + '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);
        const modal = document.getElementById('productModal');
        const backdrop = document.getElementById('modalBackdrop');
        const closeBtn = document.getElementById('modalClose');
        const modalTitle = document.getElementById('modalTitle');
        const modalPrice = document.getElementById('modalPrice');
        const modalDesc = document.getElementById('modalDesc');
        const modalMainImg = document.getElementById('modalMainImg');
        const modalThumbs = document.getElementById('modalThumbs');
        const reviewsList = document.getElementById('reviewsList');
        const noReviews = document.getElementById('noReviews');
        const submitReviewBtn = document.getElementById('submitReviewModal');
        const reviewerName = document.getElementById('reviewerNameModal');
        const reviewRating = document.getElementById('reviewRatingModal');
        const reviewText = document.getElementById('reviewTextModal');
        const modalAddCart = document.getElementById('modalAddCart');

        function openProductModal(id, productEl) {
            const productData = initialProducts.find(p => p.id === id);
            if (!productData) return; 

            modalTitle.textContent = productData.title;
            modalPrice.textContent = `₹ ${productData.price.toLocaleString('en-IN')}`;
            modalDesc.textContent = productData.desc || 'No detailed description available.';
            modalMainImg.src = productData.image; 
            modalMainImg.alt = productData.title;

            if (modalThumbs) {
                modalThumbs.innerHTML = '';
                const t = document.createElement('img');
                t.src = productData.image;
                t.className = 'thumb selected';
                modalThumbs.appendChild(t);
            }

            loadReviewsFor(id);

            if (modalAddCart) {
                modalAddCart.onclick = (e) => {
                    addToCart(e, id, productData.title, productData.price);
                    modalAddCart.classList.add('success');
                    setTimeout(()=> modalAddCart.classList.remove('success'), 700);
                };
            }

            modal.setAttribute('aria-hidden','false');
            modal.classList.add('open');
            document.body.style.overflow = 'hidden';
            modal.dataset.currentId = id;
        }

        function closeModal() {
            modal.setAttribute('aria-hidden','true');
            modal.classList.remove('open');
            document.body.style.overflow = '';
            if (reviewerName) reviewerName.value = ''; 
            if (reviewsList) reviewsList.innerHTML = '';
            modal.dataset.currentId = '';
        }
        
        if (backdrop) backdrop.addEventListener('click', closeModal);
        if (closeBtn) closeBtn.addEventListener('click', closeModal);
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modal.classList.contains('open')) closeModal(); });

        function loadReviewsFor(id) {
            const key = 'reviews:' + id;
            let arr = [];
            try {
                const raw = localStorage.getItem(key);
                if (raw) arr = JSON.parse(raw);
            } catch (e) { arr = []; }
            renderReviews(arr);
        }

        function renderReviews(list = []) {
            if (!reviewsList) return;
            reviewsList.innerHTML = '';
            if (!list.length) {
                if (noReviews) noReviews.style.display = 'block';
                return;
            }
            if (noReviews) noReviews.style.display = 'none';
            list.forEach(r => {
                const el = document.createElement('div');
                el.className = 'review';
                const time = r.time ? new Date(r.time).toLocaleString() : '';
                el.innerHTML = '<div class="meta"><span class="rating">★ ' + (r.rating||'') + '</span> <strong>' + escapeHtml(r.name||'') + '</strong> <span style="margin-left:8px;color:#888;font-size:13px">' + escapeHtml(time) + '</span></div>' +
                                '<div class="body">' + escapeHtml(r.text||'') + '</div>';
                reviewsList.appendChild(el);
            });
        }
        
        if (submitReviewBtn) {
            submitReviewBtn.addEventListener('click', () => {
                const id = modal.dataset.currentId;
                if (!id) return;
                const name = (reviewerName && reviewerName.value.trim()) || 'Anonymous';
                const rating = parseInt(reviewRating && reviewRating.value);
                const text = reviewText && reviewText.value.trim();
                if (!rating || !text) {
                    showTempNotif('Please provide rating and review text', 'error');
                    return;
                }
                const key = 'reviews:' + id;
                const cur = JSON.parse(localStorage.getItem(key) || '[]');
                cur.unshift({ name, rating, text, time: Date.now() });
                localStorage.setItem(key, JSON.stringify(cur));
                renderReviews(cur);
                if (reviewerName) reviewerName.value = '';
                if (reviewRating) reviewRating.value = '';
                if (reviewText) reviewText.value = '';
                showTempNotif('Review added', 'success');
            });
        }
        
        if (clearReviewBtn) {
            clearReviewBtn.addEventListener('click', () => {
                if (reviewerName) reviewerName.value = '';
                if (reviewRating) reviewRating.value = '';
                if (reviewText) reviewText.value = '';
            });
        }

        function showTempNotif(msg, type='success') {
            const n = document.createElement('div');
            n.className = 'notification ' + (type === 'success' ? 'success' : 'error');
            n.textContent = msg;
            document.body.appendChild(n);
            setTimeout(()=> n.classList.add('show'), 20);
            setTimeout(()=> { n.classList.remove('show'); setTimeout(()=> n.remove(), 300); }, 2000);
        }

        // --- FINAL INITIALIZATION ---
        // Runs immediately when the page and DOM are ready
        document.addEventListener('DOMContentLoaded', function() {
            populateCategoryFilter();
            updatePriceLabel();
            applyFilters(); // Renders ALL products instantly
        });
    </script>
</body>
</html>